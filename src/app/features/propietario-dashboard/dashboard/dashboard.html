<div class="dashboard-wrapper">

    <header class="dashboard-header">
        <div class="header-content">
            <h1>Panel de Propietario</h1>
            <p>Gestiona tus inmuebles y disponibilidad</p>
        </div>
        <div class="stats-summary" style="display: flex; gap: 1rem; align-items: center;">
            <div class="stat-item">
                <span class="value">{{ properties.length }}</span>
                <span class="label">Propiedades</span>
            </div>
        </div>
    </header>

    <div class="dashboard-content">

        <!-- SECTION: Create Property -->
        <aside class="create-section">
            <div class="card form-card">
                <div class="card-header">
                    <h3>{{ editingIndex !== null ? 'Editar Propiedad' : 'Nueva Propiedad' }}</h3>
                    <p>{{ editingIndex !== null ? 'Modifica los detalles del inmueble' : 'Registra un nuevo inmueble' }}
                    </p>
                </div>
                <form [formGroup]="propertyForm" (ngSubmit)="submitProperty()">
                    <div class="input-group">
                        <label>T√≠tulo del inmueble</label>
                        <input formControlName="titulo" type="text" placeholder="Ej. Casa en la playa" />
                    </div>

                    <div class="input-group">
                        <label>Descripci√≥n</label>
                        <textarea formControlName="descripcion" rows="3"
                            placeholder="Detalles importantes..."></textarea>
                    </div>

                    <div class="input-group">
                        <label>Tipo de Propiedad</label>
                        <div class="select-wrapper">
                            <select formControlName="tipo">
                                <option value="" disabled selected>Selecciona tipo</option>
                                <option value="Cuarto">Cuarto</option>
                                <option value="Depa">Depa</option>
                                <option value="Casa">Casa</option>
                            </select>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Precio Mensual (S/)</label>
                        <input formControlName="precioMensual" type="number" placeholder="0.00" />
                    </div>

                    <div class="row" style="display: flex; gap: 10px;">
                        <div class="input-group half">
                            <label>Habitaciones</label>
                            <input formControlName="habitaciones" type="number" min="1" />
                        </div>
                        <div class="input-group half">
                            <label>Ba√±os</label>
                            <input formControlName="banos" type="number" min="1" />
                        </div>
                    </div>


                    <div class="input-group">
                        <label>Departamento</label>
                        <div class="select-wrapper">
                            <select formControlName="departamento">
                                <option value="" disabled selected>Selecciona departamento</option>
                                <option *ngFor="let dep of departamentos" [value]="dep">{{ dep }}</option>
                            </select>
                        </div>
                    </div>



                    <div class="input-group">
                        <label>Direcci√≥n</label>
                        <input formControlName="direccion" type="text" placeholder="Av. Principal 123" />
                    </div>

                    <div class="row" style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                            <input type="checkbox" formControlName="amoblado" /> Amoblado
                        </label>
                        <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                            <input type="checkbox" formControlName="aceptaMascotas" /> Acepta Mascotas
                        </label>
                    </div>

                    <div class="input-group">
                        <label>Fotos (M√°x 3)</label>
                        <input type="file" multiple accept=".png, image/png" (change)="onFileSelected($event)"
                            id="fileInput" />
                        <small style="color: gray; font-size: 0.8rem;">Sube hasta 3 im√°genes.</small>
                        <small style="color: #d9534f; font-size: 0.8rem; display: block; font-weight: bold;">‚ö†Ô∏è Solo se
                            aceptan archivos PNG.</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" *ngIf="editingIndex !== null" (click)="cancelEdit()" class="btn-cancel">
                            Cancelar
                        </button>
                        <button type="submit" [disabled]="propertyForm.invalid" class="btn-submit">
                            <span *ngIf="editingIndex === null">+</span> {{ editingIndex !== null ? 'Guardar Cambios' :
                            'Publicar Propiedad' }}
                        </button>
                    </div>
                </form>
            </div>
        </aside>

        <!-- SECTION: Property List -->
        <section class="list-section">
            <div class="section-header">
                <h3>Mis Propiedades</h3>
            </div>

            <div class="properties-grid">
                <div *ngFor="let prop of properties; let i = index" class="property-card">
                    <!-- Image instead of icon -->
                    <div class="property-image-container"
                        style="width: 100px; height: 100px; overflow: hidden; border-radius: 8px; flex-shrink: 0; position: relative;">
                        <img [src]="getImageUrl(prop.fotos && prop.fotos.length > 0 ? prop.fotos[0].url : '')"
                            alt="Propiedad" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>

                    <div class="property-content">
                        <div class="property-header">
                            <h4>{{ prop.titulo }}</h4>
                        </div>

                        <p class="property-desc">{{ prop.descripcion }}</p>

                        <div class="property-meta">
                            <span class="meta-item">üìç {{ prop.departamento || prop.distrito }}</span>
                            <span class="meta-item">üí∞ S/ {{ prop.precioMensual }}</span>
                            <span class="meta-item">üõèÔ∏è {{ prop.habitaciones }} hab.</span>
                            <span class="meta-item">üöΩ {{ prop.banos }} ba√±os</span>
                        </div>

                        <div class="property-actions">
                            <button type="button" class="btn-action btn-edit" (click)="editProperty(i)"
                                style="margin-right: 10px;">
                                ‚úèÔ∏è Editar
                            </button>
                            <button type="button" class="btn-action btn-toggle" (click)="toggleRentStatus(prop)"
                                [style.background-color]="prop.alquilado ? '#ffebee' : '#e8f5e9'"
                                [style.color]="prop.alquilado ? '#c62828' : '#2e7d32'"
                                [style.border]="'1px solid ' + (prop.alquilado ? '#c62828' : '#2e7d32')"
                                style="margin-right: 10px; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                {{ prop.alquilado ? 'üî¥ Alquilado' : 'üü¢ Disponible' }}
                            </button>
                            <button type="button" class="btn-action btn-delete" (click)="deleteProperty(prop.id)"
                                style="background-color: #ff4d4d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                üóëÔ∏è Borrar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div *ngIf="properties.length === 0" class="empty-state">
                    <p>No tienes propiedades registradas a√∫n.</p>
                </div>
            </div>

        </section>


        <!-- Profile Edit Modal -->
        <div *ngIf="isProfileModalOpen" class="modal-overlay" (click)="closeProfileModal()">
            <div class="modal-content" (click)="$event.stopPropagation()">
                <div class="modal-header">
                    <h3>Editar Perfil</h3>
                    <button class="close-btn" (click)="closeProfileModal()">‚úï</button>
                </div>
                <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
                    <div class="input-group">
                        <label>Nombre Completo</label>
                        <input formControlName="nombre" type="text" />
                    </div>

                    <div class="input-group">
                        <label>Correo Electr√≥nico</label>
                        <input formControlName="email" type="email" />
                    </div>

                    <div class="input-group">
                        <label>Tel√©fono</label>
                        <input formControlName="telefono" type="text" placeholder="999999999" />
                    </div>

                    <div class="input-group">
                        <label>Direcci√≥n</label>
                        <input formControlName="direccion" type="text" placeholder="Av. Principal 123" />
                    </div>

                    <div class="modal-actions">
                        <button type="button" class="btn-cancel" (click)="closeProfileModal()">Cancelar</button>
                        <button type="submit" class="btn-submit" [disabled]="profileForm.invalid">Guardar
                            Cambios</button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>